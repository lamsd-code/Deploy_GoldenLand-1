<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <title layout:fragment="pageTitle">B√†i ƒëƒÉng c·ªßa t√¥i | SkyLand</title>
    <style>
        .status-pending { color: orange; font-weight: bold; }
        .status-approved { color: green; font-weight: bold; }
        .status-rejected { color: red; font-weight: bold; }
    </style>
</head>
<body>
<main layout:fragment="content" class="container py-5">
    <h2 class="mb-4">B√†i ƒëƒÉng c·ªßa t√¥i</h2>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>T√™n t√≤a nh√†</th>
            <th>Qu·∫≠n</th>
            <th>Ph∆∞·ªùng</th>
            <th>Tr·∫°ng th√°i</th>
            <th>H√†nh ƒë·ªông</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="b : ${posts}" th:id="'row-' + ${b.id}">
            <td th:text="${b.name}">T√™n t√≤a nh√†</td>
            <td th:text="${b.district}">Qu·∫≠n</td>
            <td th:text="${b.ward}">Ph∆∞·ªùng</td>
            <td>
                <span th:classappend="${b.status == 'PENDING' ? 'status-pending' :
                                       (b.status == 'APPROVED' ? 'status-approved' :
                                       (b.status == 'REJECTED' ? 'status-rejected' : ''))}"
                      th:text="${b.status}">Tr·∫°ng th√°i</span>
            </td>
            <td>
                <a th:href="@{/web/building-edit/{id}(id=${b.id})}" class="btn btn-primary btn-sm">S·ª≠a</a>
                <button type="button" class="btn btn-danger btn-sm btn-delete" th:data-id="${b.id}">Xo√°</button>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- ALERT -->
    <div id="customAlertBackdrop"
         style="display:none; position: fixed; inset:0; background: rgba(0,0,0,0.4); z-index: 999;"></div>
    <div id="customAlert"
         style="display:none; position: fixed; top:40%; left:50%; transform:translate(-50%,-50%);
                background:white; padding:25px 35px; border-radius:8px; text-align:center;
                box-shadow:0 3px 10px rgba(0,0,0,0.2); z-index: 1000;">
        <span id="customAlertMessage"></span>
        <button id="customAlertButton" class="btn btn-primary mt-3">OK</button>
    </div>
</main>

<th:block layout:fragment="scripts">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script th:inline="javascript">
        $(function () {
            // üü© H√†m hi·ªÉn th·ªã alert ƒë·∫πp
            function customAlert(message, callback) {
                $('#customAlertMessage').text(message);
                $('#customAlertBackdrop, #customAlert').show();
                $('#customAlertButton').off('click').on('click', function () {
                    $('#customAlertBackdrop, #customAlert').hide();
                    if (callback) callback();
                });
            }

            // üü• Xo√° b√†i ƒëƒÉng
            $('.btn-delete').click(function () {
                const id = $(this).data('id');
                if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën xo√° b√†i ƒëƒÉng n√†y?')) {
                    $.ajax({
                        type: 'DELETE',
                        url: '/web/building-delete/' + id,
                        success: function () {
                            customAlert('‚úÖ Xo√° b√†i ƒëƒÉng th√†nh c√¥ng!', function () {
                                $('#row-' + id).remove();
                            });
                        },
                        error: function (xhr) {
                            customAlert('‚ùå L·ªói khi xo√° (' + xhr.status + ')');
                        }
                    });
                }
            });
        });
    </script>
</th:block>
</body>
</html>
